<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vòng quay quà bất ngờ </title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #dbeafe, #bfdbfe);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }

    h1 {
      color: #fff;
      margin-bottom: 12px;
      text-shadow: 0 2px 6px rgba(0,0,0,0.25);
    }

    canvas {
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 20px 40px rgba(0,0,0,0.25);
      transition: box-shadow 0.4s ease, transform 0.4s ease;
    }

    canvas.glow {
      box-shadow: 0 0 0 6px rgba(59,130,246,0.35), 0 25px 50px rgba(0,0,0,0.35);
      transform: scale(1.02);
    }

    .pointer {
      width: 0;
      height: 0;
      border-left: 14px solid transparent;
      border-right: 14px solid transparent;
      border-top: 26px solid #e11d48; /* mũi tên chỉ xuống dưới */
      margin-top: -10px;
      z-index: 10;
    }

    button {
      margin-top: 24px;
      padding: 14px 28px;
      font-size: 18px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, #ec4899, #db2777);
      color: white;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,0.25);
      animation: pulse 2.2s infinite;
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(236,72,153,0.6); }
      70% { box-shadow: 0 0 0 14px rgba(236,72,153,0); }
      100% { box-shadow: 0 0 0 0 rgba(236,72,153,0); }
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .result {
      margin-top: 20px;
      font-size: 22px;
      color: #fff;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    .result.show {
      opacity: 1;
    }
  @keyframes fall {
      to { transform: translateY(110vh) rotate(360deg); opacity: 0; }
    }

    .confetti {
      position: fixed;
      top: -10px;
      width: 8px;
      height: 12px;
      background: #facc15;
      opacity: 0.9;
      animation: fall 2.5s linear forwards;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1> Quay để nhận quà </h1>

  <div class="pointer"></div>
  <canvas id="wheel" width="320" height="320"></canvas>

  <div id="confetti"></div>

  <button id="spinBtn">Quay ngay</button>
  <div id="result" class="result"></div>

  <script>
    // ====== CẤU HÌNH QUÀ ======
    const prizes = [
      "Lựa chọn 1",
      "Lựa chọn 2",
      "Lựa chọn 3",
      "Lựa chọn 4",
      "Lựa chọn 5",
      "Lựa chọn 6",
      "Lựa chọn 7",
      "Lựa chọn 8",
      "Lựa chọn 9",
      "Lựa chọn 10",
      "Lựa chọn 11",
      "Lựa chọn 12" // <-- QUÀ THẬT (bạn chỉnh tên sau)
    ];

    const forcedPrizeIndex = prizes.length - 1; // luôn trúng quà cuối

    // =========================

    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const spinBtn = document.getElementById("spinBtn");
    const resultEl = document.getElementById("result");

    const size = canvas.width;
    const center = size / 2;
    const radius = center - 10;
    const slice = (2 * Math.PI) / prizes.length;

    let angle = 0;
    let spinning = false;

    function drawWheel() {
      ctx.clearRect(0, 0, size, size);
      prizes.forEach((prize, i) => {
        const start = angle + i * slice;
        const end = start + slice;

        ctx.beginPath();
        ctx.moveTo(center, center);
        ctx.arc(center, center, radius, start, end);
        const colors = ["#fde68a", "#86efac", "#bfdbfe"]; // 3 màu xen kẽ
        ctx.fillStyle = colors[i % 3];
        ctx.fill();

        ctx.save();
        ctx.translate(center, center);
        ctx.rotate(start + slice / 2);
        ctx.textAlign = "right";
        ctx.fillStyle = "#1f2937";
        ctx.font = "16px sans-serif";
        ctx.fillText(prize, radius - 12, 6);
        ctx.restore();
      });

      ctx.beginPath();
      ctx.arc(center, center, 30, 0, Math.PI * 2);
      ctx.fillStyle = "#fff";
      ctx.fill();
    }

    drawWheel();

    spinBtn.onclick = () => {
      canvas.classList.remove("glow");
      document.getElementById("confetti").innerHTML = "";
      if (spinning) return;
      spinning = true;
      spinBtn.disabled = true;
      resultEl.classList.remove("show");

      // Góc mũi tên đang chỉ xuống dưới (270 độ)
      const pointerAngle = Math.PI * 1.5;

      // Góc trung tâm của ô trúng thưởng
      const prizeAngle = forcedPrizeIndex * slice + slice / 2;

      // Quay nhiều vòng rồi dừng đúng ô
      const targetAngle =
        2 * Math.PI * 5 + (pointerAngle - prizeAngle);

      const start = performance.now();
      const duration = 4200;
      const startAngle = angle;

      function animate(now) {
        const t = Math.min((now - start) / duration, 1);
        const ease = 1 - Math.pow(1 - t, 3);
        angle = startAngle + ease * (targetAngle - startAngle);
        drawWheel();

        if (t < 1) {
          requestAnimationFrame(animate);
        } else {
          spinning = false;
          resultEl.textContent = " Chúc mừng! Bạn nhận được: " + prizes[forcedPrizeIndex];
          resultEl.classList.add("show");
          canvas.classList.add("glow");
          launchConfetti();
        }
      }

      requestAnimationFrame(animate);
    };
      function launchConfetti() {
      const container = document.getElementById("confetti");
      for (let i = 0; i < 30; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random() * 100 + "vw";
        c.style.background = ["#fde68a", "#86efac", "#bfdbfe"][i % 3];
        c.style.animationDuration = 2 + Math.random() * 1.5 + "s";
        container.appendChild(c);
        setTimeout(() => c.remove(), 3000);
      }
    }
  </script>
</body>
</html>
